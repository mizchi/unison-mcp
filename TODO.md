# TODO - Unison MCP Server

## 優先度: 高

### 1. UCMコマンドの完全サポート
- [x] 汎用`ucm_command`ツールを実装 - 任意のUCMコマンドを実行可能
- [ ] ~~`pull` - リモートから定義を取得~~ → `ucm_command`で対応可能
- [ ] ~~`push` - リモートに定義をプッシュ~~ → `ucm_command`で対応可能
- [ ] ~~`fork` - 名前空間のフォーク~~ → `ucm_command`で対応可能
- [ ] ~~`reflog` - 変更履歴の表示~~ → `ucm_command`で対応可能
- [ ] ~~`undo` / `redo` - 操作の取り消し/やり直し~~ → `ucm_command`で対応可能

### 2. エラーハンドリングの改善
- [ ] UCMプロセスのクラッシュ検出と自動再起動
- [ ] タイムアウト処理の改善（現在は固定1秒）
- [ ] より詳細なエラーメッセージの提供
- [ ] UCMのstderrからの警告メッセージの適切な処理

### 3. Unison Share統合の強化
- [ ] 実際のShare検索APIの調査と実装
- [ ] ライブラリのバージョン一覧取得
- [ ] 依存関係の自動解決
- [ ] インストール済みライブラリのアップデート通知

## 優先度: 中

### 4. パフォーマンス改善
- [ ] UCMプロセスのプーリング（複数セッション対応）
- [ ] コマンド結果のキャッシング
- [ ] 大きな出力の効率的なストリーミング処理
- [ ] 並列コマンド実行のサポート

### 5. 開発者体験の向上
- [ ] インタラクティブなセッション管理
- [ ] プログレスインジケーターの実装
- [ ] コード補完のサポート
- [ ] シンタックスハイライトの改善

### 6. テストとドキュメント
- [ ] 各MCPツールの統合テスト
- [ ] UCMモックの作成
- [ ] APIドキュメントの自動生成
- [ ] 使用例のさらなる充実

## 優先度: 低

### 7. 高度な機能
- [ ] Unison式のデバッグサポート
- [ ] プロファイリング機能の統合
- [ ] カスタムツールの登録機能
- [ ] Webhookによるイベント通知

### 8. UI/UX改善
- [ ] Webベースの管理画面
- [ ] 実行履歴の可視化
- [ ] 依存関係グラフの生成
- [ ] コードメトリクスの表示

## 実装計画

### フェーズ1: 基礎固め（1-2週間）
1. エラーハンドリングの改善
   - UCMプロセスの健全性チェック
   - 適切なリトライメカニズム
   - ユーザーフレンドリーなエラーメッセージ

2. 基本的なUCMコマンドの追加
   - pull/pushコマンド
   - fork/reflogコマンド

### フェーズ2: Share統合（2-3週間）
1. Unison Share APIの調査
   - 公式APIドキュメントの確認
   - 認証方式の理解
   - エンドポイントの特定

2. 検索機能の実装
   - キーワード検索
   - タグ/カテゴリ検索
   - 人気度順ソート

3. 依存関係管理
   - 依存関係グラフの構築
   - 競合解決のサポート

### フェーズ3: パフォーマンス（1-2週間）
1. プロセス管理の改善
   - コネクションプーリング
   - 非同期処理の最適化

2. キャッシング戦略
   - 頻繁に使用されるコマンドの結果キャッシュ
   - TTLベースの無効化

### フェーズ4: テストと品質（継続的）
1. テストカバレッジの向上
   - ユニットテスト
   - 統合テスト
   - E2Eテスト

2. ドキュメントの充実
   - APIリファレンス
   - チュートリアル
   - トラブルシューティングガイド

## 技術的負債

### 要リファクタリング
- [ ] `sendCommand`の応答待機ロジックの改善
- [ ] エラー型の統一（現在は文字列ベース）
- [ ] モジュール構造の見直し
- [ ] 設定管理の外部化

### セキュリティ
- [ ] 一時ファイルの安全な管理
- [ ] UCMプロセスの権限制限
- [ ] 入力値のサニタイゼーション

## 貢献ガイドライン

### 新機能の追加手順
1. `src/Unison/MCP/UCM.hs`に新しい関数を追加
2. `src/Unison/MCP/Tools.hs`にMCPツール定義を追加
3. テストケースの作成
4. ドキュメントの更新

### コーディング規約
- Haskellの標準的な命名規則に従う
- 関数には型シグネチャを必ず付ける
- エラーハンドリングは明示的に行う
- 副作用のある関数はIOモナドで包む

## 参考リソース
- [Unison公式ドキュメント](https://www.unison-lang.org/docs/)
- [MCP仕様](https://github.com/anthropics/mcp)
- [Unison Share API](https://share.unison-lang.org/api/docs)（調査予定）